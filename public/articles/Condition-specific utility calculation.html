<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating utilities from HODAR data • qalyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating utilities from HODAR data">
<meta property="og:description" content="qalyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qalyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Condition-specific%20utility%20calculation.html">Estimating utilities from HODAR data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating utilities from HODAR data</h1>
                        <h4 class="author">Laura Webster</h4>
            
            <h4 class="date">2020-09-07</h4>
      
      
      <div class="hidden name"><code>Condition-specific utility calculation.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>qalyr</code> package is a collection of functions to read and process the HODAR data into a suitable form for use in our modelling. The raw data is in two files: the inpatient data and the survey data. The raw data was provided to us with only episodes with at least one tobacco- or alcohol-related diagnosis code in it.</p>
<p>With this data we want to: * Estimate utilities for each condition in the tobacco and alcohol disease list. * Estimate utilities for the whole population, stratified by age, sex, and if possible IMD quintile. (remember this is a hospital population) * Estimate age-sex-condition specific utilities.</p>
<p>Extra: * Estimate utilities for each conditions in the tobacco and alcohol disease list, stratified by tobacco and alcohol consumption. * Estimate utilities for the whol popuation, stratified by age, sex, possibly IMD quintile, and tobacco and alcohol consumption.</p>
<p>To do this, we need to combine the two data. The only variable we have to match on is the patient ID. Due to some patients having multiple admissions within the time between surveys were sent, we have designed a set of rules for matching.</p>
</div>
<div id="merging-the-inpatient-data-and-the-survey-data" class="section level1">
<h1 class="hasAnchor">
<a href="#merging-the-inpatient-data-and-the-survey-data" class="anchor"></a>Merging the inpatient data and the survey data</h1>
<p>The function <code><a href="../reference/merge_data.html">merge_data()</a></code> merges the two datasets provided: inpatient data and survey data. These are provided at episode level, for episodes with at least one diagnostic code that is tobacco or alcohol-related.</p>
<div id="format-inpatient-data" class="section level2">
<h2 class="hasAnchor">
<a href="#format-inpatient-data" class="anchor"></a>Format inpatient data</h2>
<p>The function loops through each diagnosis column in the inpatient data and searches for ICD-10 codes that match alcohol/tobacco-related conditions (using the lkup table). A new column is created for each condition in the lkup table (alcohol and tobacco related conditions) and stores a binary variable, 1 if the patient had a diagnostic code that matched that condition, and 0 if not.</p>
</div>
<div id="episode-to-admission-level" class="section level2">
<h2 class="hasAnchor">
<a href="#episode-to-admission-level" class="anchor"></a>Episode to admission level</h2>
<p>Episodes are then collapsed into admissions. All conditions that were included across the admission are retained (sum across episodes). This leaves a row for each admission, with a column for each condition signifying whether they had any diagnostic code related to alcohol or tobacco.</p>
</div>
<div id="match-data" class="section level2">
<h2 class="hasAnchor">
<a href="#match-data" class="anchor"></a>Match data</h2>
<p>The function reads in the survey data, and matches it to the inpatient data by ‘Patient_Number’. Three rules are implemented to make sure the surveys are matched to the appropriate admissions to the survey: 1. The admission must be discharged before the survey was sent, 2. The time between the patient being discharged and the survey being sent must be under a year, 3. If an admission was matched with two surveys, the admission is matched to the earliest survey.</p>
</div>
</div>
<div id="objective-one-calculating-condition-specific-utilities" class="section level1">
<h1 class="hasAnchor">
<a href="#objective-one-calculating-condition-specific-utilities" class="anchor"></a>Objective one: Calculating condition-specific utilities</h1>
<p>The function <code><a href="../reference/CalcUtils.html">CalcUtils()</a></code> calculates the average utility for each alcohol/tobacco-related condition. This is done by averaging the utility values for each condition across all surveys.</p>
<p>A utility value is extracted for each condition based on ICD-10 codes. While utilities can be extracted per age and sex group, only the mean utility is extracted because direct analysis at a condition/age level involves very small sample sizes.</p>
<p>For conditions where no utility data was available, utilities were assumed to be similar to close conditions. Thus, utilities for alcohol induced Cushing syndrome were assumed to be similar to alcoholic polyneuropathy. Utilities for alcoholic myopathy were assumed to be similar to utilities for alcohol cardiomyopathy. The utility for excessive blood level of alcohol was assumed to be similar to evidence of alcohol involvement determined by blood alcohol level. Utilities for drowning were assumed to be similar to transport injuries. Finally, utilities for other intentional injuries were assumed to be similar to other unintentional injuries. .</p>
<p>This is stored in the package in the folder <code>Data</code> as <code>util_data</code>, which can be accessed through <code>qalyr::util_data</code>.</p>
<p>Here is a sample of the condition-specific utilities for our alcohol and tobacco list…</p>
</div>
<div id="objective-two-general-population-utilities" class="section level1">
<h1 class="hasAnchor">
<a href="#objective-two-general-population-utilities" class="anchor"></a>Objective two: General population utilities</h1>
<p>We use the literature to inform our general population utilities. Baseline HSUVs profiles are assumed to be equal to the profile of HSUVs from the general population, adjusted for age and sex (i.e. all individuals irrespective of disease history). A formula was created using the Health Survey for England (n = 26,679). The code <code>Prep_GenPopUtil.R</code> creates a new data table where all combinations of age and sex are present. Age-sex-specific general population utilities are calculated using the formula from Ara and Brazier 2010 <span class="citation">(Ara and Brazier 2010)</span>:</p>
<p><span class="math display">\[Baseline\ utility = 0.9508566 + 0.0212126\ sex - 0.0002587\ age - 0.0000332\ age^2  \ \ \ \ \ \ \ \ \ \ \ [1]\]</span> This data is stored in the package in <code>Data</code> as <code>GenPopUtil</code>, and can be accessed by <code>qalyr::GenPopUtil</code>.</p>
</div>
<div id="objective-three-adjust-condition-specific-utilities-by-age-and-sex" class="section level1">
<h1 class="hasAnchor">
<a href="#objective-three-adjust-condition-specific-utilities-by-age-and-sex" class="anchor"></a>Objective three: Adjust condition-specific utilities by age and sex</h1>
<p>To calculate age-sex-condition specific HSUVs, we calculate a multiplier. The multiplier is a constant proportional effect that is applied to the age-sex-baseline HSUVs to calculate the age-sex-condition-specific HSUVs.</p>
<div id="calculate-multiplier" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-multiplier" class="anchor"></a>Calculate multiplier</h2>
<p>The multiplier for a condition is obtained using the HSUV for the condition and the baseline HSUV for individuals with the same mean age and proportion of males as the condition.</p>
<p>In order to calculate age-sex-condition specific HSUVs, we need to calculate the mean age and proportion of males in the condition population. We do this by using the merged HODAR and inpatient data collapsed into survey level data. We average across the surveys for each condition to calculate the average age and proportion of males with that condition.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r">
<span class="no">age_sex</span> <span class="kw">&lt;-</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no">Age_Sex_data</span>



<span class="fu">kable</span>(<span class="no">age_sex</span>[<span class="fl">2</span>:<span class="fl">5</span>,], <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Age and sex split of conditions"</span>)</pre></body></html></div>
<p>Need to calculate the matched age-sex-specific general population utility using Eqn [1]. In the function <code><a href="../reference/Adj_cond_utils.html">Adj_cond_utils()</a></code>, we read in the general populatin utilities (<code>qalyr::GenPopUtil</code>), the mean age and sex by condition (<code>qalyr::Age_Sex_data</code>), and the condition-specific utilities (<code>qalyr::util_data</code>). Building on Age_Sex_data, we create a column for the matched general population HSUV using the mean age and proportion of males as inputs to Eqn [1]. The matched general population HSUV gives the general population HSUV for the same population as those who get sick from that condition. This is a way to match the two HSUVs to calculate the multiplier.</p>
<p>The multiplier is simply the condition-specific HSUV (<span class="math inline">\(U_c\)</span>) divided by the matched general population HSUV (<span class="math inline">\(U_{MGP}\)</span>). This gives a constant.</p>
<p><span class="math display">\[ Multiplier_{c} = \frac{U_{c}}{U_{MGP}} \]</span> ## Adjusted condition HSUVs To calculate the age-sex-condition-specific HSUVs is then simply a case of multiplying the age-sex-specific general population HSUVs (<span class="math inline">\(U_{GP}(a,s)\)</span>) by the multiplier for each condition.</p>
<p><span class="math display">\[ U_{c}(a,s) = U_{GP}(a,s) * Multiplier_{c}\]</span></p>
<p>The age-sex-condition-specific HSUVs are stored in the package in the folder <code>Data</code> under <code>AgeSexCondUtil</code>, to be accessed using qalyr::AgeSexCondUtil. These are also saved as a csv file in the folder <code>Data-raw</code> for access outside of the package.</p>
</div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="load-and-merge-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-and-merge-data" class="anchor"></a>Load and merge data</h2>
<p>The data is stored in <code>D:/QALYs/Raw/</code>. The following code will read, clean, filter, and combine the data.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"//tsclient/X/ScHARR/PR_STAPM/Code/R_packages/qalyr_0.1.0.zip"</span>, <span class="kw">repos</span> <span class="kw">=</span> <span class="kw">NULL</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">qalyr</span>)

<span class="co"># Merge inpatient data and HODAR data and collapse to survey level data </span>
<span class="no">inpatient_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/merge_data.html">merge_data</a></span>(<span class="fu"><a href="../reference/read_data.html">read_data</a></span>())

<span class="co"># With this data we can calculate the condition-specific HSUVs, and the mean age and proportion of </span>
<span class="co"># males by condition. These are both used as inputs to calculate the age-sex-condition-specific HSUVs </span>

<span class="co"># Condition-specific utilities</span>
<span class="no">cond_utils</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/CalcUtils.html">CalcUtils</a></span>(<span class="no">inpatient_data</span>, <span class="kw">lkup</span> <span class="kw">=</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no"><a href="../reference/lkup.html">lkup</a></span>)

<span class="co"># Mean age and proportion of males </span>
<span class="no">mean_age_sex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MeanAge_Sex.html">MeanAge_Sex</a></span>(<span class="no">inpatient_data</span>, <span class="kw">lkup</span> <span class="kw">=</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no"><a href="../reference/lkup.html">lkup</a></span>)

<span class="co"># These are both saved in the package so we can call them directly without have to run these again</span>

<span class="co"># age-sex-condition-specific utilities </span>
<span class="no">adj_cond_utils</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/Adj_cond_utils.html">Adj_cond_utils</a></span>(<span class="kw">Age_Sex_data</span> <span class="kw">=</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no">Age_Sex_data</span>,
                                 <span class="kw">Condition_utilities</span> <span class="kw">=</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no">util_data</span>,
                                 <span class="kw">GenPopUtil</span> <span class="kw">=</span> <span class="kw pkg">qalyr</span><span class="kw ns">::</span><span class="no">GenPopUtil</span>)</pre></body></html></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Ara2010">
<p>Ara, Roberta, and John E Brazier. 2010. “Populating an Economic Model with Health State Utility Values: Moving Toward Better Practice.” <em>Value in Health</em> 13 (5). Wiley Online Library: 509–18.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laura Webster.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
